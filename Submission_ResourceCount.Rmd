---
title: "Submission_ResourceCount"
output:
  pdf_document: 
    latex_engine: xelatex
---

```{r analysis-preferences, echo=FALSE}

knitr::opts_chunk$set(cache.extra = knitr::rand_seed, echo=FALSE, warning=FALSE, message=FALSE)

```

Next steps (thoughts from 8/24):
Want this to be a more traditional project: DVs engagement, burnout, stress. 
How to operationalize IVs of resources, challenges, hindrances. May want to only count it if they somewhat agree or strongly agree. Could do a count or a sum of these values. The moderator of job type may work well in this idea. 

Want to include idea of item level things in terms of agreement. decreasing bar graphs relative to SD. Maybe we just present SD or SE. Thinking on SD, but ensure we have sufficient numbers of people responding to the item. 
Want to get a total count.

Alicia reflection 9/1/22: It actually appears that there may be more here with the engagement variable when reviewing the correlations. Knit and reflect more on the paper with that outcome being of focus.

John-o:
maybe use this as basis for another SIOP - extent to which resources and challenges are viewed similarly and also associations with engagement, burnout, etc... this operationalization is different than previous SIOP so could submit anew. Also would need a different approach to "similarity" - would need to look at item level


```{r study1}

temp <- read.csv("initial_data_screen.csv", header=FALSE, na.strings="")   ## NOTE: 404 vars (9/28/21) make sure to check indexing used throughout script

x <- paste("item", sep="",1:404)
y <- t(temp[2,])
                                        ## decluttering Qualtrics excess
data <- temp[-c(1:3),]                                           ## Getting rid of all 3 weird Qualtrics rows
colnames(data) <- x

incomplete <- read.csv("inprogress.csv", header=FALSE, na.strings="")   ## NOTE: 404 vars (9/28/21) make sure to check indexing used throughout script

data2 <- incomplete[-c(1:2),-c(10,12,16,113,199,285,371,379,400, 406:411)]                                          

data3 <- as.data.frame(cbind(data2$V8,data2$V9,data2$V1,data2$V1,data2$V1,data2$V1,data2$V1,data2$V1,data2))

colnames(data3) <- x

rm(x, y, temp)       

use <- rbind(data,data3)

## STILL NEED FILE WITH BAD RESPONDENTS IDENTIFIED (E.G., Item_18=2, na > 200, longstring > 20, CARELESS CHECKS > 1)

library(careless)
use$careless_long <- longstring(use[18:399])
use$missing <- rowSums(is.na(use[18:404])) 

different <- use[ which(use$item18 == 2 | use$careless_long > 20 | use$missing > 200), ]

attention <- use[which(use$item61 == 5 & use$item145 == 5 & use$item248 == 2 & use$item308 == 3), ]

data <- data.frame(lapply(attention, function(x) as.numeric(as.character(x))))
data <- data[,c(1:404)]

numtot <- nrow(use)
numkicked <- nrow(different)
numvalid <- nrow(data)

```

```{r demos}

a <- descr::freq(use$item401, plot=FALSE)

use$item402[use$item402 == "Female " | use$item402 == "female" | use$item402 == "FEMALE" | use$item402 == "Woman" | use$item402 == "Mujer" | use$item402 == "feminine" | use$item402 == "fEMALE" | use$item402 == "F" | use$item402 == "Femenale" | use$item402 == "feminino" | use$item402 == "female " | use$item402 == "Fem" | use$item402 == "Feminine" | use$item402 == "feminine" | use$item402 == "WOMAN" | use$item402 == "Femal" | use$item402 == "femenine" | use$item402 == "Femenine" | use$item402 == "femenino" | use$item402 == "woman"]  <- "Female"

use$item402[use$item402 == "gerente" | use$item402 == "M" | use$item402 == "Make" | use$item402 == "Mal" | use$item402 == "male" | use$item402 == "MALE" | use$item402 == "male" | use$item402 == "Male" | use$item402 == "mals" | use$item402 == "man" | use$item402 == "masculine" | use$item402 == "Masculine" | use$item402 == "Man" | use$item402 == "mals " | use$item402 == "male " | use$item402 == "Male "]  <- "Male"

b <- descr::freq(use$item402, plot=FALSE)

##Job title
library(labourR)


#ESCO/ISCO classification using the labourR package
#ISCO = International Standard Classification of Occupations

attention$id <- 1:nrow(attention) #adds unique identifier to satisfy inane requirement of classify_occupation()

ISCO <- classify_occupation(attention, text_col = 'item400', isco_level = 1) 

m3 <-merge(attention, ISCO, by.x = "id", by.y = "id", all.x = TRUE)

c <- descr::freq(m3$preferredLabel, plot=FALSE)

knowledge <- data[ which(m3$iscoGroup == "1" | m3$iscoGroup == "2"), ]
service <- data[ which(m3$iscoGroup == "3" | m3$iscoGroup == "4" | m3$iscoGroup == "5" | m3$iscoGroup == "6" | m3$iscoGroup == "7" | m3$iscoGroup == "8" | m3$iscoGroup == "9"), ]

data$item403[data$item403 == 2000]  <- 20

```


```{r generalrecodes, include=FALSE}

source("recodescript.R", local = knitr::knit_global())

```

There were `r nrow(data)` retained respondents.

```{r keeping45}

## need to run "recodescript.R" prior to this if running chunk-by-chunk

## variables of interest (resource, challenge, hindrance): 118:372

library(dplyr)

data22 <- data %>% 
mutate_at(vars(118:372),
function(x) recode(x,
1==NA, 
2==NA,
3==NA,
4==4,
5==5))

## attention checks: 145, 248, 308

data22$resource <- rowSums(data22[c(118:144,146:202)], na.rm=TRUE)
data22$hindrance <- rowSums(data22[c(203:247,249:287)], na.rm=TRUE)
data22$challenge <- rowSums(data22[c(288:307,309:372)], na.rm=TRUE)

cor(data22[405:407], use="all.obs")   ## something to be told with resources and challenges

data22$item387 <- 7-data22$item387
data22$burnout      <- rowMeans(data22[c(373:376)], na.rm=TRUE)
data22$stress       <- rowMeans(data22[c(377:379)], na.rm=TRUE)
data22$engagement   <- rowMeans(data22[c(380:399)], na.rm=TRUE)        ## probably need to recode some

```

```{r correlation_table}
r <- corx::corx(data22[,c(405:410)],                    
                triangle = "lower",
                stars = c(0.05, 0.01, 0.001),
                describe = c(`$M$` = mean, `$SD$` = sd))

papaja::apa_table(r$apa, # apa contains the data.frame needed for apa_table,
                  landscape = TRUE,
                  escape = FALSE)

#cor(data22[405:410], use="all.obs")   ## something to be told with resources and challenges

```

